<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The EPSO Reply Rater</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .feedback-card {
            transition: all 0.3s ease-in-out;
            transform: translateY(10px);
            opacity: 0;
        }
        .feedback-card.show {
            transform: translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl bg-white rounded-xl shadow-lg p-6 md:p-8">
        <div id="game-container">
            <div class="text-center mb-6">
                <h1 class="text-2xl md:text-3xl font-bold text-slate-800">The EPSO Reply Rater</h1>
                <p class="text-slate-500 mt-1">Hone your customer communication skills.</p>
            </div>

            <!-- Situation Display -->
            <div class="bg-red-50 border-l-4 border-red-400 p-4 rounded-lg mb-6">
                <p class="font-semibold text-red-800">Customer Message:</p>
                <p id="situation-text" class="text-red-700 mt-1"></p>
            </div>

            <!-- Agent Input -->
            <div>
                <label for="agent-reply" class="block text-sm font-medium text-slate-700 mb-1">Your Reply:</label>
                <textarea id="agent-reply" rows="6" class="w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="Type your best EPSO response here..."></textarea>
            </div>

            <div class="mt-6 flex justify-center">
                <button id="submit-btn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">
                    Rate My Reply
                </button>
            </div>
        </div>

        <!-- Feedback Display -->
        <div id="feedback-container" class="hidden">
            <h2 class="text-xl md:text-2xl font-bold text-slate-800 text-center mb-4">Your EPSO Breakdown</h2>
            <div class="space-y-3">
                <!-- Empathise -->
                <div id="e-feedback" class="feedback-card flex items-start p-4 rounded-lg">
                    <div class="mr-3 flex-shrink-0">
                        <span class="text-2xl">‚ù§Ô∏è</span>
                    </div>
                    <div>
                        <h3 class="font-bold text-slate-700">E - Empathise</h3>
                        <p class="text-slate-600 text-sm"></p>
                    </div>
                </div>
                 <!-- Personalise -->
                 <div id="p-feedback" class="feedback-card flex items-start p-4 rounded-lg">
                    <div class="mr-3 flex-shrink-0">
                        <span class="text-2xl">üéØ</span>
                    </div>
                    <div>
                        <h3 class="font-bold text-slate-700">P - Personalise</h3>
                        <p class="text-slate-600 text-sm"></p>
                    </div>
                </div>
                 <!-- Solution -->
                 <div id="s-feedback" class="feedback-card flex items-start p-4 rounded-lg">
                    <div class="mr-3 flex-shrink-0">
                        <span class="text-2xl">üí°</span>
                    </div>
                    <div>
                        <h3 class="font-bold text-slate-700">S - Solution</h3>
                        <p class="text-slate-600 text-sm"></p>
                    </div>
                </div>
                 <!-- Own -->
                 <div id="o-feedback" class="feedback-card flex items-start p-4 rounded-lg">
                    <div class="mr-3 flex-shrink-0">
                        <span class="text-2xl">ü§ù</span>
                    </div>
                    <div>
                        <h3 class="font-bold text-slate-700">O - Own</h3>
                        <p class="text-slate-600 text-sm"></p>
                    </div>
                </div>
            </div>
            <div class="mt-6 flex justify-center">
                <button id="next-btn" class="bg-slate-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 transition-transform transform hover:scale-105">
                    Next Situation
                </button>
            </div>
        </div>

        <div id="end-screen" class="hidden text-center py-8">
            <h2 class="text-2xl md:text-3xl font-bold text-slate-800">Workshop Complete!</h2>
            <p class="text-slate-500 mt-2 mb-6">Great work applying the EPSO framework.</p>
            <button id="restart-btn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">
                Practice Again
            </button>
        </div>

    </div>

    <script>
        const situations = [
            {
                id: 1,
                text: "I‚Äôve been waiting for three days and nobody has fixed my issue! This is the worst service ever.",
                personaliseKeywords: ["three days", "3 days", "waiting"]
            },
            {
                id: 2,
                text: "Why do you people keep ignoring my messages? Do I need to call your CEO to get this resolved?",
                personaliseKeywords: ["messages", "ignoring", "ceo"]
            },
            {
                id: 3,
                text: "Every time I renew my package, something goes wrong. I‚Äôm sick of this!",
                personaliseKeywords: ["renew", "package", "every time"]
            },
            {
                id: 4,
                text: "Check the chat or ask your friends because I have been explaining again in every chat.",
                personaliseKeywords: ["chat", "explaining", "again"]
            },
            {
                id: 5,
                text: "My payment was deducted, but I can‚Äôt see the listing on my account.",
                personaliseKeywords: ["payment", "deducted", "listing"]
            },
            {
                id: 6,
                text: "I specifically wanted my ad under Villas in Abu Dhabi, but now you tell me I have to recreate it under Apartments.",
                personaliseKeywords: ["villas", "abu dhabi", "apartments", "recreate"]
            },
            {
                id: 7,
                text: "I did not know that pet selling is not permitted.",
                personaliseKeywords: ["pet", "selling", "permitted"]
            },
            {
                id: 8,
                text: "I got scammed on WhatsApp, you are a bad platform and not safe!",
                personaliseKeywords: ["scammed", "whatsapp", "safe"]
            }
        ];

        let currentSituationIndex = 0;

        const situationTextEl = document.getElementById('situation-text');
        const agentReplyEl = document.getElementById('agent-reply');
        const submitBtn = document.getElementById('submit-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');
        const gameContainer = document.getElementById('game-container');
        const feedbackContainer = document.getElementById('feedback-container');
        const endScreen = document.getElementById('end-screen');

        const eFeedback = document.getElementById('e-feedback');
        const pFeedback = document.getElementById('p-feedback');
        const sFeedback = document.getElementById('s-feedback');
        const oFeedback = document.getElementById('o-feedback');
        
        function loadSituation() {
            if (currentSituationIndex < situations.length) {
                situationTextEl.textContent = situations[currentSituationIndex].text;
                agentReplyEl.value = '';
                gameContainer.style.display = 'block';
                feedbackContainer.style.display = 'none';
                endScreen.style.display = 'none';
                submitBtn.disabled = false;
            } else {
                gameContainer.style.display = 'none';
                feedbackContainer.style.display = 'none';
                endScreen.style.display = 'block';
            }
        }

        function rateReply(reply) {
            const lowerReply = reply.toLowerCase();
            const feedback = {};

            // E - Empathise
            const empathyWords = ["frustrating", "understand", "imagine", "sorry to hear", "difficult", "annoying", "concern"];
            if (empathyWords.some(word => lowerReply.includes(word))) {
                feedback.empathise = { success: true, text: "Great start! You acknowledged the customer's feelings, which helps to de-escalate the situation." };
            } else {
                feedback.empathise = { success: false, text: "Try to start by acknowledging the customer's frustration. Phrases like 'I understand this is frustrating' can make a big difference." };
            }

            // P - Personalise
            const personaliseKeywords = situations[currentSituationIndex].personaliseKeywords;
            if (personaliseKeywords.some(key => lowerReply.includes(key))) {
                feedback.personalise = { success: true, text: "Excellent! You mentioned a specific detail from their message, proving you've read it carefully." };
            } else {
                feedback.personalise = { success: false, text: "Good, but could be better. Try referencing a specific keyword from their message (like '" + personaliseKeywords[0] + "') to show you're paying attention." };
            }

            // S - Solution
            const solutionWords = ["solution", "fix", "resolve", "what we can do", "the reason is", "because", "the next step is", "you can"];
             if (solutionWords.some(word => lowerReply.includes(word))) {
                feedback.solution = { success: true, text: "Well done. You've moved towards providing a clear solution or explaining the next steps." };
            } else {
                feedback.solution = { success: false, text: "Remember to guide the customer to a solution. Explain what the next step is, or why something has happened." };
            }

            // O - Own
            const ownWords = ["i will", "i'll", "my name is", "personally", "myself", "update you", "by", "pm", "am", "make sure", "i am", "i'm"];
            if (ownWords.some(word => lowerReply.includes(word)) && lowerReply.length > 50) {
                 feedback.own = { success: true, text: "Fantastic! You took ownership of the issue and provided a clear commitment to follow up." };
            } else {
                feedback.own = { success: false, text: "Try to end with a strong statement of ownership. Use phrases like 'I will personally...' and give a specific timeline for your follow-up." };
            }
            
            return feedback;
        }

        function displayFeedback(feedback) {
            gameContainer.style.display = 'none';
            feedbackContainer.style.display = 'block';

            const feedbackMap = [
                { el: eFeedback, data: feedback.empathise },
                { el: pFeedback, data: feedback.personalise },
                { el: sFeedback, data: feedback.solution },
                { el: oFeedback, data: feedback.own },
            ];
            
            feedbackMap.forEach((item, index) => {
                const { el, data } = item;
                el.classList.remove('bg-green-100', 'border-green-400', 'bg-amber-100', 'border-amber-400');
                el.querySelector('p').textContent = data.text;
                
                if (data.success) {
                    el.classList.add('bg-green-100', 'border-green-400');
                    el.querySelector('h3').classList.add('text-green-800');
                } else {
                    el.classList.add('bg-amber-100', 'border-amber-400');
                     el.querySelector('h3').classList.add('text-amber-800');
                }
                
                // Staggered animation
                setTimeout(() => {
                    el.classList.add('show');
                }, index * 100);
            });
        }

        submitBtn.addEventListener('click', () => {
            const reply = agentReplyEl.value;
            if (reply.trim().length < 10) {
                alert("Please provide a more detailed response.");
                return;
            }
            submitBtn.disabled = true;
            const feedback = rateReply(reply);
            displayFeedback(feedback);
        });

        nextBtn.addEventListener('click', () => {
            currentSituationIndex++;
            // Remove animation classes to allow them to re-trigger
            [eFeedback, pFeedback, sFeedback, oFeedback].forEach(el => el.classList.remove('show'));
            loadSituation();
        });

        restartBtn.addEventListener('click', () => {
            currentSituationIndex = 0;
             [eFeedback, pFeedback, sFeedback, oFeedback].forEach(el => el.classList.remove('show'));
            loadSituation();
        });


        // Initial load
        loadSituation();
    </script>
</body>
</html>
